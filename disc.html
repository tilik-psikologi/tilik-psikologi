<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tes DISC | Tilik Psikologi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            user-select: none; 
            background-color: #0f172a; 
            color: white; 
            overflow-x: hidden;
            touch-action: manipulation;
        }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-m { background-color: #1e293b; border: 1px solid #334155; transition: all 0.2s; -webkit-tap-highlight-color: transparent; }
        .btn-m.selected { background-color: #059669; border-color: #10b981; color: white; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .btn-l { background-color: #1e293b; border: 1px solid #334155; transition: all 0.2s; -webkit-tap-highlight-color: transparent; }
        .btn-l.selected { background-color: #dc2626; border-color: #ef4444; color: white; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
        
        /* Animasi Transisi */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Layar Instruksi -->
    <div id="instruction-screen" class="fixed inset-0 z-[150] bg-slate-950 flex items-center justify-center p-6 text-center">
        <div class="max-w-md w-full bg-[#1e293b] rounded-[2.5rem] p-8 border border-[#334155] shadow-2xl">
            <div class="w-20 h-20 bg-blue-600 text-white rounded-3xl flex items-center justify-center mx-auto mb-6 text-3xl font-black shadow-lg">M/L</div>
            <h2 class="text-2xl font-bold mb-4">Instruksi Tes DISC</h2>
            <div class="text-slate-400 text-sm mb-8 leading-relaxed text-left space-y-3">
                <p>1. Terdapat 24 kelompok pernyataan.</p>
                <p>2. Pilih satu pernyataan yang <strong>Paling Sesuai (M)</strong> menggambarkan diri Anda.</p>
                <p>3. Pilih satu pernyataan yang <strong>Paling Tidak Sesuai (L)</strong> menggambarkan diri Anda.</p>
                <p>4. Jawab berdasarkan situasi <strong>Kerja/Profesional</strong> secara spontan.</p>
            </div>
            <button onclick="startTest()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-700 active:scale-95 transition-all">Mulai Asesmen</button>
        </div>
    </div>

    <!-- Header & Progress -->
    <div id="test-header" class="hidden w-full max-w-2xl mb-6 mt-2 flex justify-between items-end px-2">
        <div>
            <h1 class="text-lg font-black text-white leading-none">Tes <span class="text-blue-500">DISC</span></h1>
            <p id="progress-text" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Kelompok 1 / 24</p>
        </div>
        <div class="w-1/2 bg-slate-800 h-1.5 rounded-full overflow-hidden mb-1">
            <div id="progress-bar" class="bg-blue-600 h-full transition-all duration-500" style="width: 4%"></div>
        </div>
    </div>

    <!-- Main Test Area -->
    <div id="test-container" class="hidden w-full max-w-2xl glass rounded-[2.5rem] p-4 md:p-8 shadow-2xl fade-in">
        <div class="grid grid-cols-12 gap-2 mb-4 text-center text-[9px] font-black uppercase tracking-tighter text-slate-500">
            <div class="col-span-8 text-left pl-2">Pernyataan</div>
            <div class="col-span-2">M</div>
            <div class="col-span-2">L</div>
        </div>

        <div id="options-list" class="space-y-3">
            <!-- Items generated here -->
        </div>

        <div class="mt-8 flex flex-col gap-4 items-center">
            <p class="text-[10px] text-slate-500 italic text-center">Wajib pilih satu M dan satu L di setiap kelompok.</p>
            <button id="next-btn" onclick="nextGroup()" disabled class="w-full bg-blue-600 disabled:bg-slate-800 disabled:text-slate-500 text-white py-4 rounded-2xl font-bold shadow-xl transition-all active:scale-95">
                Lanjut Kelompok
            </button>
        </div>
    </div>

    <!-- Layar Hasil -->
    <div id="result-screen" class="hidden fixed inset-0 z-[200] flex items-center justify-center p-6 bg-slate-950 overflow-y-auto">
        <div class="text-center w-full max-w-xl py-12">
            <h2 class="text-3xl font-black text-white mb-2 tracking-tight">Analisis Selesai</h2>
            <p class="text-slate-500 mb-8 text-sm">Hasil profil kepribadian simulasi Anda:</p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
                <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl">
                    <p class="text-xs font-bold text-red-500 mb-1">D</p>
                    <h3 id="score-D" class="text-3xl font-black">0</h3>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl">
                    <p class="text-xs font-bold text-yellow-500 mb-1">I</p>
                    <h3 id="score-I" class="text-3xl font-black">0</h3>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl">
                    <p class="text-xs font-bold text-emerald-500 mb-1">S</p>
                    <h3 id="score-S" class="text-3xl font-black">0</h3>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl">
                    <p class="text-xs font-bold text-blue-500 mb-1">C</p>
                    <h3 id="score-C" class="text-3xl font-black">0</h3>
                </div>
            </div>

            <div class="bg-blue-900/20 border border-blue-800/50 p-6 rounded-[2rem] text-left mb-8">
                <h4 class="text-blue-400 font-bold text-xs uppercase tracking-widest mb-3 flex items-center gap-2">
                    Kesimpulan Dominan
                </h4>
                <p id="conclusion-text" class="text-slate-200 text-xs leading-relaxed">Menganalisis...</p>
            </div>

            <div class="flex flex-col gap-3">
                <button onclick="downloadPDF()" class="w-full py-4 bg-emerald-600 text-white rounded-2xl font-bold text-lg flex items-center justify-center gap-2">
                    Unduh Laporan PDF
                </button>
                <a href="index.html" class="text-slate-500 font-bold text-sm uppercase py-4">Beranda</a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBZsXx_T5-5bKp14BLhuZGNfj4Ils71nVA", authDomain: "tilikpsikologi-cbt.firebaseapp.com", projectId: "tilikpsikologi-cbt", storageBucket: "tilikpsikologi-cbt.firebasestorage.app", messagingSenderId: "940142802410", appId: "1:940142802410:web:5e6579568ed2774d9a2e93" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const questions = [
            { id: 1, opts: [{t:"Suka memulai percakapan & kenal orang baru", c:"I"}, {t:"Sangat menghargai ketelitian & data akurat", c:"C"}, {t:"Tenang & stabil di bawah tekanan", c:"S"}, {t:"Langsung ke inti masalah untuk solusi", c:"D"}] },
            { id: 2, opts: [{t:"Pendengar yang sabar & suportif", c:"S"}, {t:"Mengutamakan logika & fakta daripada perasaan", c:"C"}, {t:"Bersemangat meyakinkan/motivasi orang lain", c:"I"}, {t:"Menantang diri dengan target kompetitif", c:"D"}] },
            { id: 3, opts: [{t:"Senang berada di tim yang kooperatif", c:"S"}, {t:"Keputusan berdasarkan analisis mendalam", c:"C"}, {t:"Cepat bertindak & mendorong orang lain", c:"D"}, {t:"Antusias & penuh energi pada proyek baru", c:"I"}] },
            { id: 4, opts: [{t:"Bertindak tegas & penuh keyakinan", c:"D"}, {t:"Lebih suka bekerja mandiri & fokus", c:"C"}, {t:"Mudah bergaul & suasana menyenangkan", c:"I"}, {t:"Menjaga harmoni & menghindari konflik", c:"S"}] },
            { id: 5, opts: [{t:"Berusaha memenuhi standar kualitas tinggi", c:"C"}, {t:"Bisa beradaptasi dengan perubahan", c:"S"}, {t:"Memimpin percakapan & rapat dengan percaya diri", c:"D"}, {t:"Membangun hubungan baik dengan semua rekan", c:"I"}] },
            { id: 6, opts: [{t:"Mendorong kolaborasi & kerja sama tim", c:"S"}, {t:"Fokus pada hasil akhir & target", c:"D"}, {t:"Optimis & melihat peluang di mana-mana", c:"I"}, {t:"Memastikan semua prosedur diikuti benar", c:"C"}] },
            { id: 7, opts: [{t:"Berani mengambil risiko diperhitungkan", c:"D"}, {t:"Teliti dalam memeriksa detail kecil", c:"C"}, {t:"Stabil & konsisten dalam pendekatan kerja", c:"S"}, {t:"Inspiratif & bangkitkan semangat kelompok", c:"I"}] },
            { id: 8, opts: [{t:"Memilih lingkungan kerja terprediksi", c:"S"}, {t:"Menyukai tantangan & persaingan sehat", c:"D"}, {t:"Ramah dan disukai banyak orang", c:"I"}, {t:"Skeptis sampai semua bukti terpenuhi", c:"C"}] },
            { id: 9, opts: [{t:"Mengkritik diri untuk perbaikan terus-menerus", c:"C"}, {t:"Diplomatis & peka terhadap perasaan orang", c:"S"}, {t:"Punya karisma & kemampuan memengaruhi", c:"I"}, {t:"Mandiri & tidak mudah bergantung orang lain", c:"D"}] },
            { id: 10, opts: [{t:"Menikmati jadi pusat perhatian kelompok", c:"I"}, {t:"Berhati-hati sebelum membuat komitmen", c:"C"}, {t:"Sabar & tidak terburu-buru menyelesaikan tugas", c:"S"}, {t:"Agresif dalam mencapai tujuan yang diinginkan", c:"D"}] },
            { id: 11, opts: [{t:"Sosok yang menghibur & menyenangkan", c:"I"}, {t:"Tegas dan terkadang blak-blakan", c:"D"}, {t:"Mengutamakan rasa aman dan stabilitas", c:"S"}, {t:"Sangat sistematis & terorganisir", c:"C"}] },
            { id: 12, opts: [{t:"Suka berdebat & memenangkan argumen", c:"D"}, {t:"Loyal & dukung atasan/tim tanpa protes", c:"S"}, {t:"Antusias dan punya banyak ide", c:"I"}, {t:"Bertindak berdasarkan pedoman & aturan", c:"C"}] },
            { id: 13, opts: [{t:"Mudah berteman & perluas jaringan", c:"I"}, {t:"Percaya diri & yakin pada kemampuan sendiri", c:"D"}, {t:"Rendah hati dan tidak suka pamer", c:"S"}, {t:"Berorientasi pada detail dan presisi", c:"C"}] },
            { id: 14, opts: [{t:"Mendahulukan kepentingan & perasaan orang", c:"S"}, {t:"Kompetitif dan ingin menjadi yang terbaik", c:"D"}, {t:"Logis, objektif, dan tidak emosional", c:"C"}, {t:"Spontan dan fleksibel dengan rencana", c:"I"}] },
            { id: 15, opts: [{t:"Menuntut kinerja tinggi diri & orang lain", c:"D"}, {t:"Bisa menerima kritik & umpan balik baik", c:"S"}, {t:"Punya inisiatif tinggi & tidak suka menunggu", c:"D"}, {t:"Suka bercerita & menghidupkan suasana", c:"I"}] },
            { id: 16, opts: [{t:"Mengontrol emosi baik dalam situasi sulit", c:"S"}, {t:"Murah hati dengan pujian untuk orang lain", c:"I"}, {t:"Analitis & suka mengurai masalah per bagian", c:"C"}, {t:"Ambisius & terus dorong batas kemampuan", c:"D"}] },
            { id: 17, opts: [{t:"Pribadi menyenangkan & mudah diajak kerja sama", c:"I"}, {t:"Pemecah masalah yang langsung pada solusi", c:"D"}, {t:"Sangat berhati-hati & penuh pertimbangan", c:"C"}, {t:"Enerjik dan aktif secara fisik", c:"D"}] },
            { id: 18, opts: [{t:"Bersikap sopan & menghormati otoritas", c:"S"}, {t:"Visioner & suka membayangkan masa depan", c:"I"}, {t:"Tidak ragu ambil kendali situasi kritis", c:"D"}, {t:"Mengerjakan tugas dengan metodis & rapi", c:"C"}] },
            { id: 19, opts: [{t:"Mendengarkan dengan empati sebelum saran", c:"S"}, {t:"Mempertanyakan status quo cari cara terbaik", c:"D"}, {t:"Memastikan semua orang nyaman & diterima", c:"I"}, {t:"Mengikuti instruksi dengan tepat & konsisten", c:"C"}] },
            { id: 20, opts: [{t:"Suka mencoba hal-hal baru dan berbeda", c:"I"}, {t:"Tenang dan tidak mudah terpancing emosi", c:"S"}, {t:"Punya standar etika profesional tinggi", c:"C"}, {t:"Persuasif & bisa 'menjual' ide dengan baik", c:"I"}] },
            { id: 21, opts: [{t:"Berkomitmen pada deadline & janji", c:"C"}, {t:"Optimis segalanya akan berjalan baik", c:"I"}, {t:"Mendominasi pembicaraan diskusi kelompok", c:"D"}, {t:"Memeriksa ulang pekerjaan hindari salah", c:"C"}] },
            { id: 22, opts: [{t:"Ceria dan punya semangat yang menular", c:"I"}, {t:"Mendorong perubahan dan inovasi", c:"D"}, {t:"Sabar mengerjakan tugas repetitif rutin", c:"S"}, {t:"Independen dan tidak suka diatur ketat", c:"D"}] },
            { id: 23, opts: [{t:"Menghindari konfrontasi langsung", c:"S"}, {t:"Menikmati kesendirian berpikir mendalam", c:"C"}, {t:"Mengambil inisiatif memimpin proyek", c:"D"}, {t:"Suka bersosialisasi & acara networking", c:"I"}] },
            { id: 24, opts: [{t:"Butuh data & bukti sebelum percaya", c:"C"}, {t:"Mudah beradaptasi keinginan orang lain", c:"S"}, {t:"Percaya diri mengambil keputusan penting", c:"D"}, {t:"Memotivasi tim dengan visi & antusiasme", c:"I"}] }
        ];

        let currentIdx = 0, selectedM = null, selectedL = null, scores = { D: 0, I: 0, S: 0, C: 0 };

        window.startTest = () => {
            document.getElementById('instruction-screen').classList.add('hidden');
            document.getElementById('test-header').classList.remove('hidden');
            document.getElementById('test-container').classList.remove('hidden');
            render();
        };

        function render() {
            const group = questions[currentIdx];
            document.getElementById('progress-text').innerText = `Kelompok ${currentIdx + 1} / 24`;
            document.getElementById('progress-bar').style.width = `${((currentIdx + 1) / 24) * 100}%`;
            
            const list = document.getElementById('options-list');
            list.innerHTML = "";
            group.opts.forEach((o, i) => {
                const div = document.createElement('div');
                div.className = "grid grid-cols-12 gap-2 items-center bg-slate-900/40 p-3 rounded-2xl border border-slate-800 fade-in";
                div.innerHTML = `
                    <div class="col-span-8 text-[11px] font-medium text-slate-200 leading-tight">${o.t}</div>
                    <div class="col-span-2 flex justify-center"><button onclick="setM(${i})" class="btn-m w-9 h-9 rounded-full font-bold text-xs ${selectedM === i ? 'selected' : ''}">M</button></div>
                    <div class="col-span-2 flex justify-center"><button onclick="setL(${i})" class="btn-l w-9 h-9 rounded-full font-bold text-xs ${selectedL === i ? 'selected' : ''}">L</button></div>
                `;
                list.appendChild(div);
            });
            document.getElementById('next-btn').disabled = (selectedM === null || selectedL === null);
        }

        window.setM = (i) => { if(selectedL === i) selectedL = null; selectedM = i; render(); };
        window.setL = (i) => { if(selectedM === i) selectedM = null; selectedL = i; render(); };

        window.nextGroup = () => {
            scores[questions[currentIdx].opts[selectedM].c]++;
            currentIdx++;
            selectedM = selectedL = null;
            if(currentIdx < 24) render(); else finish();
        };

        function getConclusion() {
            const max = Math.max(scores.D, scores.I, scores.S, scores.C);
            const p = Object.keys(scores).find(k => scores[k] === max);
            const map = {
                D: "Anda memiliki gaya Dominan yang kuat. Fokus pada hasil, tegas, dan menyukai tantangan.",
                I: "Anda memiliki gaya Influencing yang menonjol. Antusias, komunikatif, dan persuasif.",
                S: "Anda memiliki gaya Steadiness yang dominan. Sabar, stabil, dan pendengar yang baik.",
                C: "Anda memiliki gaya Compliance yang kuat. Teliti, analitis, dan sangat memperhatikan detail."
            };
            return map[p] || "Profil Anda menunjukkan keseimbangan di beberapa dimensi.";
        }

        async function finish() {
            const nama = localStorage.getItem("nama_peserta") || "Peserta";
            const conc = getConclusion();
            try {
                await addDoc(collection(db, "hasil_tes"), { nama, tes: "DISC", skor: `D:${scores.D}, I:${scores.I}, S:${scores.S}, C:${scores.C}`, waktu: new Date().toLocaleString('id-ID') });
            } catch (e) {}
            document.getElementById('test-header').classList.add('hidden');
            document.getElementById('test-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            ['D','I','S','C'].forEach(k => document.getElementById(`score-${k}`).innerText = scores[k]);
            document.getElementById('conclusion-text').innerText = conc;
        }

        window.downloadPDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const nama = localStorage.getItem("nama_peserta") || "Peserta";
            doc.setFontSize(22); doc.setTextColor(30, 64, 175); doc.text("HASIL ASESMEN DISC", 20, 30);
            doc.setFontSize(11); doc.setTextColor(0, 0, 0); doc.text(`Nama: ${nama}`, 20, 50);
            doc.text(`Skor Most (M): D:${scores.D}, I:${scores.I}, S:${scores.S}, C:${scores.C}`, 20, 60);
            const split = doc.splitTextToSize(`Interpretasi Dominan: ${getConclusion()}`, 170);
            doc.text(split, 20, 80);
            doc.setDrawColor(220, 0, 0); doc.rect(15, 210, 180, 50); doc.setFontSize(8);
            const disc = "Simulasi ini hanya untuk edukasi. Pernyataan dan metode skoring ini disederhanakan dan tidak dapat dijadikan dasar untuk asesmen psikologis resmi atau seleksi karyawan. Untuk analisis akurat, konsultasikan dengan psikolog bersertifikasi.";
            doc.text(doc.splitTextToSize(`DISCLAIMER: ${disc}`, 170), 20, 225);
            doc.save(`Hasil_DISC_${nama}.pdf`);
        };
    </script>
</body>
</html>
